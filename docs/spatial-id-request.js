!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("cross-fetch")):"function"==typeof define&&define.amd?define(["exports","cross-fetch"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SpatialIdRequest={},t.window.fetch)}(this,(function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=r(e),n=function(){return n=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},n.apply(this,arguments)};function o(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))}function s(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function a(t){var e=t.default;if("function"==typeof e){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,i.get?i:{enumerable:!0,get:function(){return t[e]}})})),r}var u=h;function h(t,e){this.x=t,this.y=e}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(t){return t instanceof h?t:Array.isArray(t)?new h(t[0],t[1]):t};var l=u,f=c;function c(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(d,this,e)}function d(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function p(t){for(var e,r,i=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],i+=((r=t[s]).x-e.x)*(e.y+r.y);return i}c.types=["Unknown","Point","LineString","Polygon"],c.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,o=0,s=0,a=[];t.pos<r;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new l(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&a.push(e),a},c.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,s=1/0,a=-1/0,u=1/0,h=-1/0;t.pos<e;){if(i<=0){var l=t.readVarint();r=7&l,i=l>>3}if(i--,1===r||2===r)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<u&&(u=o),o>h&&(h=o);else if(7!==r)throw new Error("unknown command "+r)}return[s,u,a,h]},c.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),s=this.extent*t,a=this.extent*e,u=this.loadGeometry(),h=c.types[this.type];function l(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+a)/o;t[e]=[360*(r.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(i=0;i<u.length;i++)f[i]=u[i][0];l(u=f);break;case 2:for(i=0;i<u.length;i++)l(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var s=p(t[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}r&&n.push(r);return n}(u),i=0;i<u.length;i++)for(n=0;n<u[i].length;n++)l(u[i][n])}1===u.length?u=u[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:u},properties:this.properties};return"id"in this&&(d.id=this.id),d};var g=f,y=m;function m(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(v,this,e),this.length=this._features.length}function v(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(r))}m.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new g(this._pbf,e,this.extent,this._keys,this._values)};var w=y,b=function(t,e){this.layers=t.readFields(x,{},e)};function x(t,e,r){if(3===t){var i=new w(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}var M=b,S={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,r,i,n){var o,s,a=8*n-i-1,u=(1<<a)-1,h=u>>1,l=-7,f=r?n-1:0,c=r?-1:1,d=t[e+f];for(f+=c,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=c,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;l>0;s=256*s+t[e+f],f+=c,l-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),o-=h}return(d?-1:1)*s*Math.pow(2,o-i)},write:function(t,e,r,i,n,o){var s,a,u,h=8*o-n-1,l=(1<<h)-1,f=l>>1,c=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,p=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+f>=1?c/u:c*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,n),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,n),s=0));n>=8;t[r+d]=255&a,d+=p,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;t[r+d]=255&s,d+=p,s/=256,h-=8);t[r+d-p]|=128*g}},P=_,F=S;function _(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}_.Varint=0,_.Fixed64=1,_.Bytes=2,_.Fixed32=5;var E=4294967296,B=1/E,k="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function V(t){return t.type===_.Bytes?t.readVarint()+t.pos:t.pos+1}function A(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function L(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function X(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Y(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function O(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function T(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function R(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function j(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function N(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function C(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function q(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function z(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function G(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function D(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function I(t,e,r){void 0===r&&(r={});var i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=e||{},i.geometry=t,i}function J(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return I({type:"LineString",coordinates:t},e,r)}function U(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function W(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function H(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function K(t){return"Feature"===t.type?t.geometry:t}function Q(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),n=K(e),o=n.type,s=e.bbox,a=n.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(i,s))return!1;"Polygon"===o&&(a=[a]);for(var u=!1,h=0;h<a.length&&!u;h++)if(Z(i,a[h][0],r.ignoreBoundary)){for(var l=!1,f=1;f<a[h].length&&!l;)Z(i,a[h][f],!r.ignoreBoundary)&&(l=!0),f++;l||(u=!0)}return u}function Z(t,e,r){var i=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,o=e.length-1;n<e.length;o=n++){var s=e[n][0],a=e[n][1],u=e[o][0],h=e[o][1];if(t[1]*(s-u)+a*(u-t[0])+h*(t[0]-s)==0&&(s-t[0])*(u-t[0])<=0&&(a-t[1])*(h-t[1])<=0)return!r;a>t[1]!=h>t[1]&&t[0]<(u-s)*(t[1]-a)/(h-a)+s&&(i=!i)}return i}function $(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function tt(t,e){!function(t,e){var r,i,n,o,s,a,u,h,l,f,c=0,d="FeatureCollection"===t.type,p="Feature"===t.type,g=d?t.features.length:1;for(r=0;r<g;r++){for(a=d?t.features[r].geometry:p?t.geometry:t,h=d?t.features[r].properties:p?t.properties:{},l=d?t.features[r].bbox:p?t.bbox:void 0,f=d?t.features[r].id:p?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=u?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,c,h,l,f))return!1;break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===e(o.geometries[i],c,h,l,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,c,h,l,f))return!1;c++}}(t,(function(t,r,i,n,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(I(t,i,{bbox:n,id:o}),r,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<t.coordinates.length;u++){var h=t.coordinates[u];if(!1===e(I({type:s,coordinates:h},i),r,u))return!1}}))}function et(t){if(!t)throw new Error("geojson is required");var e=[];return tt(t,(function(t){!function(t,e){var r=[],i=t.geometry;if(null!==i){switch(i.type){case"Polygon":r=H(i);break;case"LineString":r=[H(i)]}r.forEach((function(r){var i=function(t,e){var r=[];return t.reduce((function(t,i){var n,o,s,a,u,h,l=J([t,i],e);return l.bbox=(o=i,s=(n=t)[0],a=n[1],u=o[0],h=o[1],[s<u?s:u,a<h?a:h,s>u?s:u,a>h?a:h]),r.push(l),i})),r}(r,t.properties);i.forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),U(e)}_.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=z(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=D(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=z(this.buf,this.pos)+z(this.buf,this.pos+4)*E;return this.pos+=8,t},readSFixed64:function(){var t=z(this.buf,this.pos)+D(this.buf,this.pos+4)*E;return this.pos+=8,t},readFloat:function(){var t=F.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=F.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,n,o=r.buf;if(n=o[r.pos++],i=(112&n)>>4,n<128)return A(t,i,e);if(n=o[r.pos++],i|=(127&n)<<3,n<128)return A(t,i,e);if(n=o[r.pos++],i|=(127&n)<<10,n<128)return A(t,i,e);if(n=o[r.pos++],i|=(127&n)<<17,n<128)return A(t,i,e);if(n=o[r.pos++],i|=(127&n)<<24,n<128)return A(t,i,e);if(n=o[r.pos++],i|=(1&n)<<31,n<128)return A(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&k?function(t,e,r){return k.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var i="",n=e;for(;n<r;){var o,s,a,u=t[n],h=null,l=u>239?4:u>223?3:u>191?2:1;if(n+l>r)break;1===l?u<128&&(h=u):2===l?128==(192&(o=t[n+1]))&&(h=(31&u)<<6|63&o)<=127&&(h=null):3===l?(o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&((h=(15&u)<<12|(63&o)<<6|63&s)<=2047||h>=55296&&h<=57343)&&(h=null)):4===l&&(o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((h=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,l=1):h>65535&&(h-=65536,i+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),i+=String.fromCharCode(h),n+=l}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==_.Bytes)return t.push(this.readVarint(e));var r=V(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==_.Bytes)return t.push(this.readSVarint());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==_.Bytes)return t.push(this.readBoolean());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==_.Bytes)return t.push(this.readFloat());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==_.Bytes)return t.push(this.readDouble());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==_.Bytes)return t.push(this.readFixed32());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==_.Bytes)return t.push(this.readSFixed32());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==_.Bytes)return t.push(this.readFixed64());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==_.Bytes)return t.push(this.readSFixed64());var e=V(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===_.Varint)for(;this.buf[this.pos++]>127;);else if(e===_.Bytes)this.pos=this.readVarint()+this.pos;else if(e===_.Fixed32)this.pos+=4;else{if(e!==_.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),G(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),G(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),G(this.buf,-1&t,this.pos),G(this.buf,Math.floor(t*B),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),G(this.buf,-1&t,this.pos),G(this.buf,Math.floor(t*B),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,n,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&L(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),F.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),F.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&L(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,_.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,X,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Y,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,R,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,O,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,T,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,j,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,N,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,C,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,q,e)},writeBytesField:function(t,e){this.writeTag(t,_.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,_.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,_.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,_.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,_.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,_.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,_.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,_.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,_.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,_.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var rt={exports:{}};function it(t,e,r,i,n){nt(t,e,r||0,i||t.length-1,n||st)}function nt(t,e,r,i,n){for(;i>r;){if(i-r>600){var o=i-r+1,s=e-r+1,a=Math.log(o),u=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);nt(t,e,Math.max(r,Math.floor(e-s*u/o+h)),Math.min(i,Math.floor(e+(o-s)*u/o+h)),n)}var l=t[e],f=r,c=i;for(ot(t,r,e),n(t[i],l)>0&&ot(t,r,i);f<c;){for(ot(t,f,c),f++,c--;n(t[f],l)<0;)f++;for(;n(t[c],l)>0;)c--}0===n(t[r],l)?ot(t,r,c):ot(t,++c,i),c<=e&&(r=c+1),e<=c&&(i=c-1)}}function ot(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function st(t,e){return t<e?-1:t>e?1:0}function at(t,e,r){if(!r)return e.indexOf(t);for(let i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function ut(t,e){ht(t,0,t.children.length,e,t)}function ht(t,e,r,i,n){n||(n=vt(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let o=e;o<r;o++){const e=t.children[o];lt(n,t.leaf?i(e):e)}return n}function lt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function ft(t,e){return t.minX-e.minX}function ct(t,e){return t.minY-e.minY}function dt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function pt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function gt(t,e){const r=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,n-r)*Math.max(0,o-i)}function yt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function mt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function vt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wt(t,e,r,i,n){const o=[e,r];for(;o.length;){if((r=o.pop())-(e=o.pop())<=i)continue;const s=e+Math.ceil((r-e)/i/2)*i;it(t,s,e,r,n),o.push(e,s,s,r)}}var bt=Object.freeze({__proto__:null,default:class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!mt(t,e))return r;const i=this.toBBox,n=[];for(;e;){for(let o=0;o<e.children.length;o++){const s=e.children[o],a=e.leaf?i(s):s;mt(t,a)&&(e.leaf?r.push(s):yt(t,a)?this._all(s,r):n.push(s))}e=n.pop()}return r}collides(t){let e=this.data;if(!mt(t,e))return!1;const r=[];for(;e;){for(let i=0;i<e.children.length;i++){const n=e.children[i],o=e.leaf?this.toBBox(n):n;if(mt(t,o)){if(e.leaf||yt(t,o))return!0;r.push(n)}}e=r.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=vt([]),this}remove(t,e){if(!t)return this;let r=this.data;const i=this.toBBox(t),n=[],o=[];let s,a,u;for(;r||n.length;){if(r||(r=n.pop(),a=n[n.length-1],s=o.pop(),u=!0),r.leaf){const i=at(t,r.children,e);if(-1!==i)return r.children.splice(i,1),n.push(r),this._condense(n),this}u||r.leaf||!yt(r,i)?a?(s++,r=a.children[s],u=!1):r=null:(n.push(r),o.push(s),s=0,a=r,r=r.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,i){const n=r-e+1;let o,s=this._maxEntries;if(n<=s)return o=vt(t.slice(e,r+1)),ut(o,this.toBBox),o;i||(i=Math.ceil(Math.log(n)/Math.log(s)),s=Math.ceil(n/Math.pow(s,i-1))),o=vt([]),o.leaf=!1,o.height=i;const a=Math.ceil(n/s),u=a*Math.ceil(Math.sqrt(s));wt(t,e,r,u,this.compareMinX);for(let n=e;n<=r;n+=u){const e=Math.min(n+u-1,r);wt(t,n,e,a,this.compareMinY);for(let r=n;r<=e;r+=a){const n=Math.min(r+a-1,e);o.children.push(this._build(t,r,n,i-1))}}return ut(o,this.toBBox),o}_chooseSubtree(t,e,r,i){for(;i.push(e),!e.leaf&&i.length-1!==r;){let r,i=1/0,s=1/0;for(let a=0;a<e.children.length;a++){const u=e.children[a],h=dt(u),l=(n=t,o=u,(Math.max(o.maxX,n.maxX)-Math.min(o.minX,n.minX))*(Math.max(o.maxY,n.maxY)-Math.min(o.minY,n.minY))-h);l<s?(s=l,i=h<i?h:i,r=u):l===s&&h<i&&(i=h,r=u)}e=r||e.children[0]}var n,o;return e}_insert(t,e,r){const i=r?t:this.toBBox(t),n=[],o=this._chooseSubtree(i,this.data,e,n);for(o.children.push(t),lt(o,i);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(i,n,e)}_split(t,e){const r=t[e],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);const o=this._chooseSplitIndex(r,n,i),s=vt(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,ut(r,this.toBBox),ut(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)}_splitRoot(t,e){this.data=vt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ut(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let i,n=1/0,o=1/0;for(let s=e;s<=r-e;s++){const e=ht(t,0,s,this.toBBox),a=ht(t,s,r,this.toBBox),u=gt(e,a),h=dt(e)+dt(a);u<n?(n=u,i=s,o=h<o?h:o):u===n&&h<o&&(o=h,i=s)}return i||r-e}_chooseSplitAxis(t,e,r){const i=t.leaf?this.compareMinX:ft,n=t.leaf?this.compareMinY:ct;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,n)&&t.children.sort(i)}_allDistMargin(t,e,r,i){t.children.sort(i);const n=this.toBBox,o=ht(t,0,e,n),s=ht(t,r-e,r,n);let a=pt(o)+pt(s);for(let i=e;i<r-e;i++){const e=t.children[i];lt(o,t.leaf?n(e):e),a+=pt(o)}for(let i=r-e-1;i>=e;i--){const e=t.children[i];lt(s,t.leaf?n(e):e),a+=pt(s)}return a}_adjustParentBBoxes(t,e,r){for(let i=r;i>=0;i--)lt(e[i],t)}_condense(t){for(let e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children,e.splice(e.indexOf(t[r]),1)):this.clear():ut(t[r],this.toBBox)}}}),xt=a(bt),Mt={};!function(t){function e(t,e,r){void 0===r&&(r={});var i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=e||{},i.geometry=t,i}function r(t,r,i){if(void 0===i&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!c(t[0])||!c(t[1]))throw new Error("coordinates must contain numbers");return e({type:"Point",coordinates:t},r,i)}function i(t,r,i){void 0===i&&(i={});for(var n=0,o=t;n<o.length;n++){var s=o[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return e({type:"Polygon",coordinates:t},r,i)}function n(t,r,i){if(void 0===i&&(i={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return e({type:"LineString",coordinates:t},r,i)}function o(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function s(t,r,i){return void 0===i&&(i={}),e({type:"MultiLineString",coordinates:t},r,i)}function a(t,r,i){return void 0===i&&(i={}),e({type:"MultiPoint",coordinates:t},r,i)}function u(t,r,i){return void 0===i&&(i={}),e({type:"MultiPolygon",coordinates:t},r,i)}function h(e,r){void 0===r&&(r="kilometers");var i=t.factors[r];if(!i)throw new Error(r+" units is invalid");return e*i}function l(e,r){void 0===r&&(r="kilometers");var i=t.factors[r];if(!i)throw new Error(r+" units is invalid");return e/i}function f(t){return 180*(t%(2*Math.PI))/Math.PI}function c(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=e,t.geometry=function(t,e,o){switch(t){case"Point":return r(e).geometry;case"LineString":return n(e).geometry;case"Polygon":return i(e).geometry;case"MultiPoint":return a(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return u(e).geometry;default:throw new Error(t+" is invalid")}},t.point=r,t.points=function(t,e,i){return void 0===i&&(i={}),o(t.map((function(t){return r(t,e)})),i)},t.polygon=i,t.polygons=function(t,e,r){return void 0===r&&(r={}),o(t.map((function(t){return i(t,e)})),r)},t.lineString=n,t.lineStrings=function(t,e,r){return void 0===r&&(r={}),o(t.map((function(t){return n(t,e)})),r)},t.featureCollection=o,t.multiLineString=s,t.multiPoint=a,t.multiPolygon=u,t.geometryCollection=function(t,r,i){return void 0===i&&(i={}),e({type:"GeometryCollection",geometries:t},r,i)},t.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},t.radiansToLength=h,t.lengthToRadians=l,t.lengthToDegrees=function(t,e){return f(l(t,e))},t.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},t.radiansToDegrees=f,t.degreesToRadians=function(t){return t%360*Math.PI/180},t.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return h(l(t,e),r)},t.convertArea=function(e,r,i){if(void 0===r&&(r="meters"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=t.areaFactors[r];if(!n)throw new Error("invalid original units");var o=t.areaFactors[i];if(!o)throw new Error("invalid final units");return e/n*o},t.isNumber=c,t.isObject=function(t){return!!t&&t.constructor===Object},t.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!c(t))throw new Error("bbox must only contain numbers")}))},t.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}}(Mt);var St={};Object.defineProperty(St,"__esModule",{value:!0});var Pt=Mt;function Ft(t,e,r){if(null!==t)for(var i,n,o,s,a,u,h,l,f=0,c=0,d=t.type,p="FeatureCollection"===d,g="Feature"===d,y=p?t.features.length:1,m=0;m<y;m++){a=(l=!!(h=p?t.features[m].geometry:g?t.geometry:t)&&"GeometryCollection"===h.type)?h.geometries.length:1;for(var v=0;v<a;v++){var w=0,b=0;if(null!==(s=l?h.geometries[v]:h)){u=s.coordinates;var x=s.type;switch(f=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(u,c,m,w,b))return!1;c++,w++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(!1===e(u[i],c,m,w,b))return!1;c++,"MultiPoint"===x&&w++}"LineString"===x&&w++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(n=0;n<u[i].length-f;n++){if(!1===e(u[i][n],c,m,w,b))return!1;c++}"MultiLineString"===x&&w++,"Polygon"===x&&b++}"Polygon"===x&&w++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(b=0,n=0;n<u[i].length;n++){for(o=0;o<u[i][n].length-f;o++){if(!1===e(u[i][n][o],c,m,w,b))return!1;c++}b++}w++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===Ft(s.geometries[i],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _t(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function Et(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function Bt(t,e){var r,i,n,o,s,a,u,h,l,f,c=0,d="FeatureCollection"===t.type,p="Feature"===t.type,g=d?t.features.length:1;for(r=0;r<g;r++){for(a=d?t.features[r].geometry:p?t.geometry:t,h=d?t.features[r].properties:p?t.properties:{},l=d?t.features[r].bbox:p?t.bbox:void 0,f=d?t.features[r].id:p?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=u?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,c,h,l,f))return!1;break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===e(o.geometries[i],c,h,l,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,c,h,l,f))return!1;c++}}function kt(t,e){Bt(t,(function(t,r,i,n,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Pt.feature(t,i,{bbox:n,id:o}),r,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<t.coordinates.length;u++){var h={type:s,coordinates:t.coordinates[u]};if(!1===e(Pt.feature(h,i),r,u))return!1}}))}function Vt(t,e){kt(t,(function(t,r,i){var n=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,u=0,h=0;return!1!==Ft(t,(function(o,l,f,c,d){if(void 0===s||r>a||c>u||d>h)return s=o,a=r,u=c,h=d,void(n=0);var p=Pt.lineString([s,o],t.properties);if(!1===e(p,r,i,d,n))return!1;n++,s=o}))&&void 0}}}))}function At(t,e){if(!t)throw new Error("geojson is required");kt(t,(function(t,r,i){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===e(t,r,i,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(Pt.lineString(o[s],t.properties),r,i,s))return!1}}}))}St.coordAll=function(t){var e=[];return Ft(t,(function(t){e.push(t)})),e},St.coordEach=Ft,St.coordReduce=function(t,e,r,i){var n=r;return Ft(t,(function(t,i,o,s,a){n=0===i&&void 0===r?t:e(n,t,i,o,s,a)}),i),n},St.featureEach=Et,St.featureReduce=function(t,e,r){var i=r;return Et(t,(function(t,n){i=0===n&&void 0===r?t:e(i,t,n)})),i},St.findPoint=function(t,e){if(e=e||{},!Pt.isObject(e))throw new Error("options is invalid");var r,i=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":i<0&&(i=t.features.length+i),a=a||t.features[i].properties,r=t.features[i].geometry;break;case"Feature":a=a||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return Pt.point(u,a,e);case"MultiPoint":return n<0&&(n=u.length+n),Pt.point(u[n],a,e);case"LineString":return s<0&&(s=u.length+s),Pt.point(u[s],a,e);case"Polygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s),Pt.point(u[o][s],a,e);case"MultiLineString":return n<0&&(n=u.length+n),s<0&&(s=u[n].length+s),Pt.point(u[n][s],a,e);case"MultiPolygon":return n<0&&(n=u.length+n),o<0&&(o=u[n].length+o),s<0&&(s=u[n][o].length-s),Pt.point(u[n][o][s],a,e)}throw new Error("geojson is invalid")},St.findSegment=function(t,e){if(e=e||{},!Pt.isObject(e))throw new Error("options is invalid");var r,i=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":i<0&&(i=t.features.length+i),a=a||t.features[i].properties,r=t.features[i].geometry;break;case"Feature":a=a||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),Pt.lineString([u[s],u[s+1]],a,e);case"Polygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s-1),Pt.lineString([u[o][s],u[o][s+1]],a,e);case"MultiLineString":return n<0&&(n=u.length+n),s<0&&(s=u[n].length+s-1),Pt.lineString([u[n][s],u[n][s+1]],a,e);case"MultiPolygon":return n<0&&(n=u.length+n),o<0&&(o=u[n].length+o),s<0&&(s=u[n][o].length-s-1),Pt.lineString([u[n][o][s],u[n][o][s+1]],a,e)}throw new Error("geojson is invalid")},St.flattenEach=kt,St.flattenReduce=function(t,e,r){var i=r;return kt(t,(function(t,n,o){i=0===n&&0===o&&void 0===r?t:e(i,t,n,o)})),i},St.geomEach=Bt,St.geomReduce=function(t,e,r){var i=r;return Bt(t,(function(t,n,o,s,a){i=0===n&&void 0===r?t:e(i,t,n,o,s,a)})),i},St.lineEach=At,St.lineReduce=function(t,e,r){var i=r;return At(t,(function(t,n,o,s){i=0===n&&void 0===r?t:e(i,t,n,o,s)})),i},St.propEach=_t,St.propReduce=function(t,e,r){var i=r;return _t(t,(function(t,n){i=0===n&&void 0===r?t:e(i,t,n)})),i},St.segmentEach=Vt,St.segmentReduce=function(t,e,r){var i=r,n=!1;return Vt(t,(function(t,o,s,a,u){i=!1===n&&void 0===r?t:e(i,t,o,s,a,u),n=!0})),i};var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});var Xt=St;function Yt(t){var e=[1/0,1/0,-1/0,-1/0];return Xt.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}Yt.default=Yt,Lt.default=Yt;var Ot=xt,Tt=Mt,Rt=St,jt=Lt.default,Nt=Rt.featureEach;Rt.coordEach;var Ct=Tt.featureCollection;function qt(t){var e=new Ot(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:jt(t),Ot.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:jt(t),e.push(t)})):Nt(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:jt(t),e.push(t)})),Ot.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:jt(t),Ot.prototype.remove.call(this,t,e)},e.clear=function(){return Ot.prototype.clear.call(this)},e.search=function(t){var e=Ot.prototype.search.call(this,this.toBBox(t));return Ct(e)},e.collides=function(t){return Ot.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ot.prototype.all.call(this);return Ct(t)},e.toJSON=function(){return Ot.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ot.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=jt(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=jt(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function zt(t,e){var r={},i=[];if("LineString"===t.type&&(t=I(t)),"LineString"===e.type&&(e=I(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var n=Gt(t,e);return n&&i.push(n),U(i)}var o=rt.exports();return o.load(et(e)),$(et(t),(function(t){$(o.search(t),(function(e){var n=Gt(t,e);if(n){var o=H(n).join(",");r[o]||(r[o]=!0,i.push(n))}}))})),U(i)}function Gt(t,e){var r=H(t),i=H(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=r[0][0],o=r[0][1],s=r[1][0],a=r[1][1],u=i[0][0],h=i[0][1],l=i[1][0],f=i[1][1],c=(f-h)*(s-n)-(l-u)*(a-o),d=(l-u)*(o-h)-(f-h)*(n-u),p=(s-n)*(o-h)-(a-o)*(n-u);if(0===c)return null;var g=d/c,y=p/c;return g>=0&&g<=1&&y>=0&&y<=1?function(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!W(t[0])||!W(t[1]))throw new Error("coordinates must contain numbers");return I({type:"Point",coordinates:t},e,r)}([n+g*(s-n),o+g*(a-o)]):null}function Dt(t,e){void 0===e&&(e={});var r=K(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),r.type){case"Polygon":return function(t,e){void 0===e&&(e={});var r=K(t).coordinates,i=e.properties?e.properties:"Feature"===t.type?t.properties:{};return It(r,i)}(r,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var r=K(t).coordinates,i=e.properties?e.properties:"Feature"===t.type?t.properties:{},n=[];return r.forEach((function(t){n.push(It(t,i))})),U(n)}(r,e);default:throw new Error("invalid poly")}}function It(t,e){return t.length>1?function(t,e,r){return void 0===r&&(r={}),I({type:"MultiLineString",coordinates:t},e,r)}(t,e):J(t[0],e)}function Jt(t,e){var r=!0;return tt(t,(function(t){tt(e,(function(e){if(!1===r)return!1;r=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,i=e.coordinates,!(r[0]===i[0]&&r[1]===i[1]);case"LineString":return!Ut(e,t);case"Polygon":return!Q(t,e)}break;case"LineString":switch(e.type){case"Point":return!Ut(t,e);case"LineString":return!function(t,e){if(zt(t,e).features.length>0)return!0;return!1}(t,e);case"Polygon":return!Wt(e,t)}break;case"Polygon":switch(e.type){case"Point":return!Q(e,t);case"LineString":return!Wt(t,e);case"Polygon":return!function(t,e){for(var r=0,i=t.coordinates[0];r<i.length;r++){if(Q(i[r],e))return!0}for(var n=0,o=e.coordinates[0];n<o.length;n++){if(Q(o[n],t))return!0}if(zt(Dt(t),Dt(e)).features.length>0)return!0;return!1}(e,t)}}var r,i;return!1}(t.geometry,e.geometry)}))})),r}function Ut(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(Ht(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function Wt(t,e){for(var r=0,i=e.coordinates;r<i.length;r++){if(Q(i[r],t))return!0}return zt(e,Dt(t)).features.length>0}function Ht(t,e,r){var i=r[0]-t[0],n=r[1]-t[1],o=e[0]-t[0],s=e[1]-t[1];return 0==i*s-n*o&&(Math.abs(o)>=Math.abs(s)?o>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:s>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1])}function Kt(t,e){var r=!1;return tt(t,(function(t){tt(e,(function(e){if(!0===r)return!0;r=!Jt(t.geometry,e.geometry)}))})),r}rt.exports=qt,rt.exports.default=qt;var Qt=i.default.bind(void 0);t.requestToGeoJSON=function(t,e){return o(void 0,void 0,void 0,(function(){var r,i,o,a,u,h,l,f,c,d,p,g,y,m,v,w,b,x,S;return s(this,(function(s){switch(s.label){case 0:return r=t,"url"in t?[4,Qt(t.url)]:[3,3];case 1:if(!(i=s.sent()).ok)throw new Error("TileJSON request to ".concat(t.url," failed: ").concat(i.status," ").concat(i.statusText));return o=[{}],[4,i.json()];case 2:r=n.apply(void 0,[n.apply(void 0,o.concat([s.sent()])),r]),s.label=3;case 3:if(!("tiles"in r))throw new Error("TileJSON must contain a 'tiles' property");if(a=r.tiles,u=r.minzoom,h=r.maxzoom,void 0!==(l=u||0)&&e.zoom<l)throw new Error("Not implemented: zoom level of requested Spatial ID (".concat(e.zoom,") is below minimum zoom ").concat(l));return f=Math.min(h||25,e.zoom),c=f<e.zfxy.z?e.parent(f):e,d=function(t,e){return t.replace("{z}",e.zfxy.z.toString()).replace("{f}",e.zfxy.f.toString()).replace("{x}",e.zfxy.x.toString()).replace("{y}",e.zfxy.y.toString())}(a[0],c),[4,Qt(d)];case 4:if(!(p=s.sent()).ok)throw new Error("Tile request to ".concat(d," failed: ").concat(p.status," ").concat(p.statusText));return[4,p.arrayBuffer()];case 5:for(w in g=s.sent(),y=new M(new P(g)),m={type:"FeatureCollection",features:[]},v=e.toGeoJSON(),y.layers)for(b=y.layers[w],x=0;x<b.length;x++)S=b.feature(x).toGeoJSON(c.zfxy.x,c.zfxy.y,c.zfxy.z),Kt(v,S)&&m.features.push(S);return[2,m]}}))}))},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
